{"version":3,"sources":["webpack:///./src/packages/piechart/piechart.vue?0333","webpack:///./src/packages/piechart/piechart.vue?0630","webpack:///./src/packages/piechart/piechart.vue?0d13","webpack:///./src/packages/piechart/piechart.vue?1e7c","uni-app:///src/packages/piechart/piechart.vue","webpack:///./src/packages/piechart/piechart.vue?a84e","webpack:///./src/packages/piechart/piechart.vue?17fa"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiI;AACjI;AAC4D;AACL;AACqC;;;AAG5F;AACmI;AACnI,gBAAgB,gJAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,+FAAM;AACR,EAAE,wGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAqc,CAAgB,ieAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACczd,S,qBAAA,CAEA,C;AACA;AACA;AACA;AACA,kBADA;AAEA;AAFA,KAFA;AAMA;AACA;AACA,kBADA;AAEA;AAFA,KAPA;AAWA;AACA;AACA,kBADA;AAEA;AAFA,KAZA;AAgBA;AACA;AACA,kBADA;AAEA;AAFA,KAjBA;AAqBA;AACA;AACA,kBADA;AAEA;AAFA,KAtBA;AA0BA;AACA;AACA,kBADA;AAEA;AAFA,KA3BA;AA+BA;AACA;AACA,kBADA;AAEA;AAFA,KAhCA;AAoCA;AACA,kBADA;AAEA;AAFA,KApCA;AAwCA;AACA;AACA,mBADA;AAEA;AAFA,KAzCA;AA6CA;AACA;AACA,kBADA;AAEA;AAFA,KA9CA;AAkDA;AACA;AACA,kBADA;AAEA;AAFA,KAnDA;AAuDA;AACA,iBADA;AAEA;AAAA;AAAA;AAFA;AAvDA;wEA4DA;AACA;;AACA;AACA;AACA;AACA,C,kEACA;AACA;AACA,oBADA;AAEA,mBAFA;AAGA,mBAHA;AAIA;AAJA;AAMA,C,mDACA;AACA,cADA,0BACA;AACA;AACA;AACA,GAJA;AAKA,QALA,oBAKA;AACA;AACA;;AACA;AACA;AACA;AACA,GAXA;AAYA,cAZA,0BAYA;AACA;AACA;;AACA;AACA;AACA;AACA;AAlBA,C,qDAoBA;AACA,gBADA,4BACA;AACA;AACA;AACA,GAJA;AAKA,UALA,sBAKA;AAEA,0BAFA,CAGA;;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mCADA;AAEA,8BAFA;AAGA,0BAHA;AAIA,6BAJA;AAKA,6DALA,CAKA;;AALA;AAOA;AACA;AACA;AACA;;AACA;AACA,GAhCA;AAiCA,aAjCA,uBAiCA,CAjCA,EAiCA;AAEA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAJA,CAKA;;AACA;AACA,KAPA,EAOA,IAPA;AASA,GAtDA;AAwDA,uBAxDA,iCAwDA,OAxDA,EAwDA,OAxDA,EAwDA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAJA,CAKA;;AACA;;AAEA;AACA;AACA;AACA,mFAHA,CAIA;AACA,SALA,MAKA,CACA;AACA,SAfA,CAgBA;;AAEA,OAlBA,MAkBA;AAEA;AACA;;AACA,+CAJA,CAKA;;;AACA;;AACA;AACA;AACA;AACA,qFAHA,CAIA;AACA,SALA,MAKA,CACA;AACA,SAdA,CAeA;;AACA,OAhBA,MAgBA;AACA;AACA;AACA,KAvCA,MAuCA;AACA;AAEA;AACA;AACA;AACA;;AACA,gDAJA,CAKA;;;AACA;;AAEA;AACA;AACA;AACA,sFAHA,CAIA;AACA,SALA,MAKA,CACA;AACA,SAfA,CAgBA;;AAEA,OAlBA,MAkBA;AAEA;AACA;;AACA,gDAJA,CAKA;;;AACA;;AACA;AACA;AACA;AACA,sFAHA,CAIA;AACA,SALA,MAKA,CACA;AACA,SAdA,CAeA;;AACA,OAhBA,MAgBA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA,GApJA;AAuJA,eAvJA,yBAuJA,KAvJA,EAuJA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;;AACA;AACA;AACA;AACA,+BAHA,CAIA;AACA;;AACA;AACA;AACA;AACA,GAzKA;AA2KA,cA3KA,wBA2KA,KA3KA,EA2KA;AAEA;AACA;AACA,oCAJA,CAKA;;AACA;AACA;;AACA,8BAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BANA,CAOA;;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA,qBAJA,CAIA;AACA;;AACA;AAEA,KApCA,CAqCA;;;AACA;;AACA;AACA;AACA,iBAFA,CAGA;AACA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA,OATA,CAUA;;;AACA;AACA;;AAEA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA,sDAFA,CAGA;;AACA;AACA,4BALA,CAMA;;AACA;AACA;;AACA;AAEA;;AACA;;AACA;AACA;AACA;AACA,oCADA;AAEA,oBAFA;AAGA;AACA;AACA;AACA;AACA;AACA,WARA;AASA,cATA,gBASA,QATA,EASA;AACA;AACA;AAXA,WAYA,IAZA;AAaA,OAdA;AAeA,KAhBA,MAgBA;AACA;AACA;AAEA;AApQA,C;;;;;;;;;;;;;;;AC/GA;AAAA;AAAA;AAAA;AAAgrB,CAAgB,orBAAG,EAAC,C;;;;;;;;;;;ACApsB;AACA,OAAO,KAAU,EAAE,kBAKd","file":"packages/piechart/piechart.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./piechart.vue?vue&type=template&id=6f7c625b&scoped=true&\"\nvar renderjs\nimport script from \"./piechart.vue?vue&type=script&lang=js&\"\nexport * from \"./piechart.vue?vue&type=script&lang=js&\"\nimport style0 from \"./piechart.vue?vue&type=style&index=0&id=6f7c625b&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6f7c625b\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"packages/piechart/piechart.vue\"\nexport default component.exports","export * from \"-!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-0!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./piechart.vue?vue&type=template&id=6f7c625b&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./piechart.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./piechart.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view id=\"canvasbgView\" class=\"canvasbgView\"\r\n\t\t:style=\"{width:maxRadius * 2 + 'px',height: maxRadius * 2 + 'px'}\">\r\n\t\t<view class=\"canvasView\" @click=\"canvasClick($event)\">\r\n\t\t\t<canvas \r\n\t\t\t\t:style=\"{width:maxRadius * 2 + 'px',height: maxRadius * 2 + 'px',backgroundColor:backgroundColor}\"\r\n\t\t\t\tcanvas-id=\"piechartCanvas\" id=\"piechartCanvas\">\r\n\t\t\t</canvas>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tmounted() {\r\n\r\n\t\t},\r\n\t\tprops: {\r\n\t\t\t//饼图的半径\r\n\t\t\tradius: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 150\r\n\t\t\t},\n\t\t\t//触摸屏幕后，选中时的饼图的半径 ，大于等于饼图半径\n\t\t\tselectRadius:{\n\t\t\t\ttype: Number,\n\t\t\t\tdefault: -1\n\t\t\t},\r\n\t\t\t//标题的文字大小\r\n\t\t\ttitleFontSize: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 13\r\n\t\t\t},\r\n\t\t\t//正常标题的颜色\r\n\t\t\ttitleColor: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"#fff\"\r\n\t\t\t},\r\n\t\t\t//选中的标题的颜色\r\n\t\t\ttitleSelectColor: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"#fff\"\r\n\t\t\t},\r\n\t\t\t//选中的单块拼图的背景颜色\r\n\t\t\tselectColor: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"#4BD0D8\"\r\n\t\t\t},\r\n\t\t\t//绘图的线条颜色\r\n\t\t\tstrokeStyle: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"#F8F8F8\"\r\n\t\t\t},\r\n\t\t\tlineWidth: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0.5\r\n\t\t\t},\r\n\t\t\t//是否启用触摸点击\r\n\t\t\tisEnableTouch: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t//canvas背景色\r\n\t\t\tbackgroundColor: {\r\n\t\t\t\ttype: String,\n\t\t\t\tdefault: 'transparent',\r\n\t\t\t},\n\t\t\t//canvas背景图片链接\n\t\t\tbackgroundImageUrl: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: '',\n\t\t\t},\n\t\t\tpieChartData:{\n\t\t\t\ttype: Array,\n\t\t\t\tdefault: () => []\n\t\t\t},\r\n\t\t},\n\t\tmounted() {\n\t\t\tthis.maxRadius = Math.max(this.radius,this.selectRadius)\n\t\t\tif (this.pieChartData.length > 0){\n\t\t\t\tthis.updatePieChart()\n\t\t\t}\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tpiechartList: [],\r\n\t\t\t\tcanvasImg: null,\n\t\t\t\tselectIndex:-1,\n\t\t\t\tmaxRadius:Math.max(this.radius,this.selectRadius)\r\n\t\t\t}\r\n\t\t},\n\t\twatch: {\n\t\t\tpieChartData(){\n\t\t\t\t// console.log('监听', this.pieChartData)\n\t\t\t\tthis.updatePieChart()\n\t\t\t},\n\t\t\tradius() {\n\t\t\t\t// console.log('监听', this.radius)\n\t\t\t\tthis.maxRadius = Math.max(this.radius,this.selectRadius)\n\t\t\t\tif (this.pieChartData.length > 0){\n\t\t\t\t\tthis.drawPieChart(-1)\n\t\t\t\t}\n\t\t\t},\n\t\t\tselectRadius() {\n\t\t\t\t// console.log('监听', this.selectRadius)\n\t\t\t\tthis.maxRadius = Math.max(this.radius,this.selectRadius)\n\t\t\t\tif (this.pieChartData.length > 0){\n\t\t\t\t\tthis.drawPieChart(-1)\n\t\t\t\t}\n\t\t\t},\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tupdatePieChart() {\n\t\t\t\tthis.initData()\n\t\t\t\tthis.drawPieChart(-1)\r\n\t\t\t},\r\n\t\t\tinitData() {\r\n\r\n\t\t\t\tvar piechartList = []\n\t\t\t\t//从正上方开始算角度\r\n\t\t\t\tvar startAngle = 1.5 * Math.PI\r\n\t\t\t\tvar endAngle = 0\r\n\t\t\t\tlet everyAngle = (1 / this.pieChartData.length) * Math.PI * 2\r\n\t\t\t\tlet everyAngleInterval = (1 / this.pieChartData.length) * 360\r\n\t\t\t\tvar startAngleInterval = 0\r\n\t\t\t\tvar endAngleInterval = 0\r\n\r\n\t\t\t\tfor (var i = 0; i < this.pieChartData.length; i++) {\r\n\t\t\t\t\tlet chartData = this.pieChartData[i]\r\n\t\t\t\t\tendAngle = startAngle + everyAngle\r\n\t\t\t\t\tendAngleInterval = startAngleInterval + everyAngleInterval\r\n\t\t\t\t\tlet item = {\r\n\t\t\t\t\t\tfillColor: chartData.colour,\r\n\t\t\t\t\t\tstartAngle: startAngle,\r\n\t\t\t\t\t\tendAngle: endAngle,\r\n\t\t\t\t\t\ttext: chartData.title,\r\n\t\t\t\t\t\tangleInterval: [startAngleInterval, endAngleInterval] //单个饼图的与正Y轴的角度区间\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpiechartList.push(item)\r\n\t\t\t\t\tstartAngle = endAngle\r\n\t\t\t\t\tstartAngleInterval = endAngleInterval\r\n\t\t\t\t}\r\n\t\t\t\tthis.piechartList = piechartList\r\n\t\t\t},\r\n\t\t\tcanvasClick(e) {\r\n\r\n\t\t\t\t// console.log(e)\r\n\t\t\t\tif (!this.isEnableTouch) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\n\t\t\t\tlet padding = this.maxRadius - this.radius\n\t\t\t\t\r\n\t\t\t\tvar originX = e.detail.x - padding\r\n\t\t\t\tvar originY = e.detail.y - padding\r\n\t\t\t\tlet that = this\r\n\t\t\t\tconst query = uni.createSelectorQuery().in(this);\r\n\t\t\t\tquery.select('#canvasbgView').boundingClientRect(data => {\r\n\t\t\t\t\t// console.log(\"得到布局位置信息\" , data);\r\n\t\t\t\t\t// console.log(\"节点离页面顶部的距离为\");\r\n\t\t\t\t\toriginX = originX - data.left\r\n\t\t\t\t\toriginY = originY - data.top\r\n\t\t\t\t\t// console.log('---'+originX+\"-++++\"+originY)\r\n\t\t\t\t\tthat.clickPieChartPosition(originX, originY)\r\n\t\t\t\t}).exec();\r\n\r\n\t\t\t},\r\n\r\n\t\t\tclickPieChartPosition(originX, originY) {\r\n\r\n\t\t\t\t/*点击拼图获取对应的饼图的思路：\r\n\t\t\t\t1、判断点击位置是否落在饼图上，通过点击的位置，计算以饼图为圆心做为原点，算出与Y轴和X轴的距离，\r\n\t\t\t\t点击位置与原点的距离 = （Y轴距离的平方 + X轴距离的平方）的根号，点击位置与原点的距离 <= 饼图的半径，说明点击位置落在饼图上\r\n\t\t\t\t2、找出具体点击的是哪块饼图，通过点击的位置，用正切值来计算正切角度，从而计算出点击位置的与原点的正Y轴上的夹角，\r\n\t\t\t\t通过比较夹角是否落在饼图夹角范围，找出具体是那块饼图\r\n\t\t\t\t*/\r\n\t\t\t\tvar includedAngle = -1\r\n\t\t\t\tif (originX < this.radius) {\r\n\t\t\t\t\t//左半部分的半圆\r\n\t\t\t\t\tif (originY > this.radius) {\r\n\t\t\t\t\t\t//说明点击的地方在圆心的正下方\r\n\t\t\t\t\t\t// 与饼图为圆心坐标的，距离的X轴的距离\r\n\t\t\t\t\t\tlet positionY = originY - this.radius\r\n\t\t\t\t\t\tlet positionX = this.radius - originX\r\n\t\t\t\t\t\t//计算点击点的圆的半径\r\n\t\t\t\t\t\tlet clickRadius = Math.sqrt(Math.pow(positionX, 2) + Math.pow(positionY, 2))\r\n\r\n\t\t\t\t\t\tif (clickRadius < this.radius) {\r\n\t\t\t\t\t\t\t//点击点的半径小于饼图圆的半径，说明点击落在饼图上\r\n\t\t\t\t\t\t\t//计算与正方Y轴的夹角，通过正切值来求角度，因为点击点在X轴的下方，所以要+90度\r\n\t\t\t\t\t\t\tincludedAngle = 270 - Math.atan(positionY / positionX) / (Math.PI / 180)\r\n\t\t\t\t\t\t\t// console.log('与正Y轴的角的度数:'+includedAngle)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// console.log('点击不落在饼图上')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// console.log(clickRadius)\r\n\r\n\t\t\t\t\t} else if (originY < this.radius) {\r\n\r\n\t\t\t\t\t\t// 与饼图为圆心坐标的，距离的X轴的距离\r\n\t\t\t\t\t\tlet positionY = this.radius - originY\r\n\t\t\t\t\t\tlet positionX = this.radius - originX\r\n\t\t\t\t\t\t//说明点击的地方在圆心的正上方\r\n\t\t\t\t\t\tlet clickRadius = Math.sqrt(Math.pow(positionX, 2) + Math.pow(positionY, 2))\r\n\t\t\t\t\t\tif (clickRadius < this.radius) {\r\n\t\t\t\t\t\t\t//点击点的半径小于饼图圆的半径，说明点击落在饼图上\r\n\t\t\t\t\t\t\t//计算与正方Y轴的夹角，通过正切值来求角度，因为点击点在X轴的上方，所以要90度-正切的角度\r\n\t\t\t\t\t\t\tincludedAngle = 270 + Math.atan(positionY / positionX) / (Math.PI / 180)\r\n\t\t\t\t\t\t\t// console.log('与正Y轴的角的度数:'+includedAngle)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// console.log('点击不落在饼图上')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// console.log(clickRadius)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tincludedAngle = 90\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//右半部分的半圆\r\n\r\n\t\t\t\t\tif (originY > this.radius) {\r\n\t\t\t\t\t\t//说明点击的地方在圆心的正下方\r\n\t\t\t\t\t\t// 与饼图为圆心坐标的，距离的X轴的距离\r\n\t\t\t\t\t\tlet positionY = originY - this.radius\r\n\t\t\t\t\t\tlet positionX = originX - this.radius\r\n\t\t\t\t\t\t//计算点击点的圆的半径\r\n\t\t\t\t\t\tlet clickRadius = Math.sqrt(Math.pow(positionX, 2) + Math.pow(positionY, 2))\r\n\r\n\t\t\t\t\t\tif (clickRadius < this.radius) {\r\n\t\t\t\t\t\t\t//点击点的半径小于饼图圆的半径，说明点击落在饼图上\r\n\t\t\t\t\t\t\t//计算与正方Y轴的夹角，通过正切值来求角度，因为点击点在X轴的下方，所以要+90度\r\n\t\t\t\t\t\t\tincludedAngle = Math.atan(positionY / positionX) / (Math.PI / 180) + 90\r\n\t\t\t\t\t\t\t// console.log('与正Y轴的角的度数:'+includedAngle)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// console.log('点击不落在饼图上')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// console.log(clickRadius)\r\n\r\n\t\t\t\t\t} else if (originY < this.radius) {\r\n\r\n\t\t\t\t\t\t// 与饼图为圆心坐标的，距离的X轴的距离\r\n\t\t\t\t\t\tlet positionY = this.radius - originY\r\n\t\t\t\t\t\tlet positionX = originX - this.radius\r\n\t\t\t\t\t\t//说明点击的地方在圆心的正上方\r\n\t\t\t\t\t\tlet clickRadius = Math.sqrt(Math.pow(positionX, 2) + Math.pow(positionY, 2))\r\n\t\t\t\t\t\tif (clickRadius < this.radius) {\r\n\t\t\t\t\t\t\t//点击点的半径小于饼图圆的半径，说明点击落在饼图上\r\n\t\t\t\t\t\t\t//计算与正方Y轴的夹角，通过正切值来求角度，因为点击点在X轴的上方，所以要90度-正切的角度\r\n\t\t\t\t\t\t\tincludedAngle = 90 - Math.atan(positionY / positionX) / (Math.PI / 180)\r\n\t\t\t\t\t\t\t// console.log('与正Y轴的角的度数:'+includedAngle)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// console.log('点击不落在饼图上')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// console.log(clickRadius)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tincludedAngle = 90\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (includedAngle >= 0) {\r\n\t\t\t\t\tthis.clickPieChart(includedAngle)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\r\n\t\t\tclickPieChart(angle) {\r\n\t\t\t\tfor (var i = 0; i < this.piechartList.length; i++) {\r\n\t\t\t\t\tlet item = this.piechartList[i]\r\n\t\t\t\t\tlet angleInterval = item.angleInterval\r\n\t\t\t\t\tif (angleInterval[0] < angle && angleInterval[1] >= angle) {\n\t\t\t\t\t\tif (this.selectIndex === i){\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.selectIndex = i\r\n\t\t\t\t\t\tif (i < this.pieChartData.length) {\r\n\t\t\t\t\t\t\tlet selectObj = this.pieChartData[i]\r\n\t\t\t\t\t\t\tthis.$emit('touchPieChart', selectObj,i)\r\n\t\t\t\t\t\t\tthis.drawPieChart(i)\r\n\t\t\t\t\t\t\t// console.log(\"点击拼图：\" + selectObj.valName)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tdrawPieChart(index) {\r\n\r\n\t\t\t\tlet ctx = uni.createCanvasContext('piechartCanvas', this)\n\t\t\t\tctx.width = this.maxRadius*2\n\t\t\t\tctx.height = this.maxRadius*2\r\n\t\t\t\t//清除画布，需要设置画布的背景颜色，才能达到清除效果\r\n\t\t\t\tctx.clearRect(0, 0, this.maxRadius * 2, this.maxRadius * 2)\n\t\t\t\tlet imageUrl = this.backgroundImageUrl || \"\"\n\t\t\t\tif (imageUrl.length > 0){\n\t\t\t\t\t\n\t\t\t\t}\r\n\t\t\t\tfor (var i = 0; i < this.piechartList.length; i++) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tlet item = this.piechartList[i]\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(this.maxRadius, this.maxRadius);\r\n\t\t\t\t\tvar fillColor = item.fillColor\r\n\t\t\t\t\tvar radius = this.radius\r\n\t\t\t\t\t//点击选择的效果\r\n\t\t\t\t\tif (index === i) {\r\n\t\t\t\t\t\tfillColor = this.selectColor\r\n\t\t\t\t\t\tradius = this.maxRadius\r\n\t\t\t\t\t}\n\t\t\t\t\t\r\n\t\t\t\t\tctx.fillStyle = fillColor\r\n\t\t\t\t\tctx.arc(this.maxRadius, this.maxRadius, radius, item.startAngle, item.endAngle, false);\r\n\t\t\t\t\tctx.fill();\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\tif (this.piechartList.length !== 1) {\r\n\t\t\t\t\t\tctx.lineWidth = this.lineWidth\r\n\t\t\t\t\t\tctx.strokeStyle = this.strokeStyle;\r\n\t\t\t\t\t\tctx.strok\r\n\t\t\t\t\t\tctx.stroke(); //绘制线条\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.restore();\r\n\r\n\t\t\t\t}\r\n\t\t\t\t//每个瓣状的角度\r\n\t\t\t\tlet angle = 360 / this.piechartList.length\r\n\t\t\t\tfor (var i = 0; i < this.piechartList.length; i++) {\r\n\t\t\t\t\tlet text = this.piechartList[i].text\r\n\t\t\t\t\tctx.save()\r\n\t\t\t\t\t//设置字体颜色\r\n\t\t\t\t\t//点击选择的效果\r\n\t\t\t\t\tif (index === i) {\r\n\t\t\t\t\t\tctx.fillStyle = this.titleSelectColor\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctx.fillStyle = this.titleColor\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//设置字体的大小\r\n\t\t\t\t\tctx.setFontSize(this.titleFontSize);\r\n\t\t\t\t\tlet textWidth = ctx.measureText(text).width\r\n                    \n\t\t\t\t\tif (this.piechartList.length === 1){\n\t\t\t\t\t\t//只有一个的时候，文本居中显示\n\t\t\t\t\t\tctx.fillText(text, this.maxRadius - textWidth / 2.0, this.maxRadius)\n\t\t\t\t\t}else{\n\t\t\t\t\t\t//设置画布的旋转中心\n\t\t\t\t\t\tctx.translate(this.maxRadius, this.maxRadius);\n\t\t\t\t\t\t//旋转角度，angle/2+3 为了显示在瓣状的中间，angle*i 度数计算， -90 为了从竖直正上方开始显示\n\t\t\t\t\t\tlet rotate1 = (angle / 2 + 5 + angle * i - 90) * Math.PI / 180\n\t\t\t\t\t\tctx.rotate(rotate1)\n\t\t\t\t\t\t//设置文本，和文本的位置\n\t\t\t\t\t\tctx.fillText(text, this.radius / 2.0 - textWidth / 2.0 + 20, 0)\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.restore();\r\n\r\n\t\t\t\t}\r\n\t\t\t\tlet that = this\n\t\t\t\tif (index === -1 && this.pieChartData.length > 0){\n\t\t\t\t\tctx.draw(true, function() {\n\t\t\t\t\t\tuni.canvasToTempFilePath({\n\t\t\t\t\t\t\tcanvasId: 'piechartCanvas',\n\t\t\t\t\t\t\tquality:1,\n\t\t\t\t\t\t\tsuccess: function(res) {\n\t\t\t\t\t\t\t\t// 在H5平台下，tempFilePath 为 base64\n\t\t\t\t\t\t\t\tthat.canvasImg = res.tempFilePath\n\t\t\t\t\t\t\t\tthat.$emit('canvasScreenshot',res.tempFilePath)\n\t\t\t\t\t\t\t\tconsole.log('------'+res.tempFilePath)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfail(response) {\n\t\t\t\t\t\t\t\tconsole.log(response)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, that)\n\t\t\t\t\t})\n\t\t\t\t}else{\n\t\t\t\t\tctx.draw()\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t.canvasbgView {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.canvasView {\r\n\t\tbackground-color: transparent;\r\n\t\tposition: absolute;\r\n\t}\r\n</style>\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./piechart.vue?vue&type=style&index=0&id=6f7c625b&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./piechart.vue?vue&type=style&index=0&id=6f7c625b&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1631086690022\n      var cssReload = require(\"/Users/weiqu/Documents/GitApp/jj-uni/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}